name: Deploy Server

on:
  workflow_dispatch:
    inputs:
      deploy_type:
        description: 'Deploy Type'
        required: true
        default: 'smart'
        type: choice
        options:
        - smart
        - full

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Build Server Pack
      run: python build_pack.py server

    - name: Install dependencies
      run: pip install paramiko

    - name: Smart Deploy via SFTP
      env:
        SFTP_HOST: ${{ secrets.SFTP_HOST }}
        SFTP_USER: ${{ secrets.SFTP_USERNAME }}
        SFTP_PASS: ${{ secrets.SFTP_PASSWORD }}
        SFTP_PORT: ${{ secrets.SFTP_PORT || 22 }}
        TARGET_DIR: ${{ vars.SFTP_TARGET_DIR }}
        FORCE_FULL: ${{ github.event.inputs.deploy_type == 'full' }}
      run: python deploy_smart.py
